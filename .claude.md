# Google Colab Notebooks - Project Context

**Purpose**: Educational bioinformatics notebooks for [learn.evomics.org](https://learn.evomics.org)

---

## üéØ Project Goals

1. **"Just Works" Philosophy**: Students click "Run All" in Google Colab ‚Üí notebook executes start to finish without blocking
2. **Local Testing First**: 95% of issues caught locally using conda environment before Colab validation
3. **Educational Quality**: Clear explanations, interpretation exercises, professional visualizations
4. **Instructor Support**: Complete teaching resources for workshop leaders

---

## üìÅ Repository Structure

```
google-collab-notebooks/
‚îú‚îÄ‚îÄ phylogenetics_tutorial.ipynb           # Main student-facing tutorial
‚îú‚îÄ‚îÄ phylogenetics_tutorial_INSTRUCTOR.ipynb # Complete teaching guide
‚îú‚îÄ‚îÄ README.md                               # User documentation
‚îú‚îÄ‚îÄ DEVELOPMENT_GUIDE.md                    # Development workflow & best practices
‚îú‚îÄ‚îÄ COMPLETE_WORKFLOW.md                    # Technical workflow details
‚îú‚îÄ‚îÄ CONSISTENCY_REVIEW.md                   # Tutorial consistency analysis
‚îú‚îÄ‚îÄ activate.sh                             # Conda environment helper
‚îú‚îÄ‚îÄ test_tools.py                           # Verify tool installation
‚îî‚îÄ‚îÄ .playwright-mcp/                        # Browser automation artifacts
```

---

## üîß Development Workflow

### Local Testing Environment

**Conda Environment**: `phylo-dev`
- Python 3.14
- MAFFT v7.526
- IQ-TREE v3.0.1
- All Python packages (biopython, toytree, pandas, etc.)

**Activation**:
```bash
conda activate phylo-dev
# OR
source activate.sh
```

### Testing Cycle

1. **Edit** notebook cells
2. **Test locally**:
   ```bash
   jupyter nbconvert --to notebook --execute \
     phylogenetics_tutorial.ipynb \
     --ExecutePreprocessor.timeout=600 \
     --output tested_notebook.ipynb
   ```
3. **Iterate** until all cells pass
4. **Commit** working version
5. **Validate in Colab** (final check for visual/UI issues)

**Expected Runtime**: ~4 minutes locally, ~5-7 minutes in Colab

---

## üö´ Critical Design Rules

### 1. Never Block "Run All" Execution

**‚ùå BAD**:
```python
if IN_COLAB:
    uploaded = files.upload()  # BLOCKS!
    input_file = list(uploaded.keys())[0]
```

**‚úÖ GOOD**:
```python
# Use embedded example data - no blocking
example_data = """..."""
with open('example.fasta', 'w') as f:
    f.write(example_data)
input_file = 'example.fasta'
```

### 2. Embed Example Data

Always include complete example datasets in the notebook:
- Students can run immediately
- Testing is reproducible
- No external dependencies

### 3. Consistent Explanation Depth

All analysis sections should have:
- **Conceptual explanation** (What/Why/How)
- **Parameter descriptions** (What flags mean)
- **Interpretation guidance** (How to read results)

See `CONSISTENCY_REVIEW.md` for detailed analysis.

### 4. Colab vs Local Compatibility

```python
try:
    from google.colab import files
    IN_COLAB = True
except ImportError:
    IN_COLAB = False

# Adapt behavior but never block
if IN_COLAB:
    # Download results (at END only)
    files.download('results.txt')
else:
    print("‚úì Files saved locally")
```

---

## üìä Current Tutorial: Phylogenetics

**File**: `phylogenetics_tutorial.ipynb`
**Status**: ‚úÖ Production ready
**Runtime**: 60-75 minutes
**Cells**: 34
**Topics**: MAFFT ‚Üí ModelFinder ‚Üí IQ-TREE ‚Üí toytree visualization

### Key Features

- **Environment setup**: Auto-installs MAFFT, IQ-TREE in Colab
- **Example dataset**: 6 mammalian cytochrome b sequences
- **Full workflow**: Alignment ‚Üí Model selection ‚Üí Tree inference ‚Üí Visualization
- **Interpretation exercises**: 3 guided exercises with expected answers
- **Bootstrap analysis**: 1000 ultrafast bootstrap replicates
- **Visualization**: Color-coded bootstrap support, branch length analysis
- **Export**: SVG trees, analysis summary, Newick files

### Consistency Updates (2025-01-17)

Added conceptual explanations to Sections 6-7 to match depth of Sections 3-5:
- **Section 6**: Bootstrap support explanation (what resampling means, how to interpret values)
- **Section 7**: Branch length interpretation (evolutionary distance, rate variation)

### Known Expected Results

**Alignment**:
- 6 sequences, 690 bp
- Mean conservation: 85-90%
- Mean identity to consensus: 92-95%

**Model Selection**:
- Best model: Usually HKY+F+G4 or GTR+F+G4
- Log-likelihood: -2800 to -2900

**Tree Topology**:
```
Primates: Human-Chimpanzee-Gorilla (100% support)
Rodents: Mouse-Rat (100% support)
Outgroup: Whale (most basal)
```

**Bootstrap Support**:
- 80-100% of branches have ‚â•95% support
- Mean support: 90-100%
- All branches exceed 70% threshold

**Branch Lengths**:
- Human-Chimp: 0.01-0.03 (closest)
- Rodents: Often fastest evolution
- Total tree length: 0.3-0.5 substitutions/site

---

## üë©‚Äçüè´ Instructor Guide

**File**: `phylogenetics_tutorial_INSTRUCTOR.ipynb`
**Created**: 2025-01-17

### Contents

- **Section-by-section guide** with expected outputs, teaching tips, common misconceptions
- **Grading rubric** (50 points) with detailed criteria
- **Troubleshooting FAQ** (25+ common issues)
- **Teaching strategies** for different workshop formats
- **Discussion prompts** for each section
- **Resource links** for further learning

### Workshop Formats

1. **Guided workshop**: 90 min with checkpoints
2. **Flipped classroom**: Homework + discussion
3. **Self-paced online**: Independent with support

---

## üéì Pedagogical Principles

1. **Progressive complexity**: Start simple, build understanding
2. **Active learning**: Interpretation exercises, not just code execution
3. **Immediate feedback**: Code output shows results instantly
4. **Biological context**: Connect to real organisms and evolution
5. **Professional practices**: Teach tools/methods used in research
6. **Self-contained**: No external dependencies or downloads required

---

## üêõ Common Issues & Solutions

### Installation
- **Issue**: "apt-get not found"
  **Fix**: Not in Colab; use conda locally

### Runtime
- **Issue**: Notebook "freezes" during tree inference
  **Fix**: Not frozen, just computing (2-5 min is normal)

### Results
- **Issue**: Tree looks different
  **Fix**: Tree rotation is cosmetic; check groupings, not visual arrangement

### Visualization
- **Issue**: Tree too small
  **Fix**: Increase `width` parameter (default 1200, try 1600)

---

## üìù Commit Message Format

```
<type>: <description>

<detailed explanation>

Tested: <local/colab/both>

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

**Types**: Fix, Add, Update, Remove, Refactor, Docs

---

## üîÑ Git Workflow

```bash
# Test locally
jupyter nbconvert --execute notebook.ipynb --output tested.ipynb

# Commit when passing
git add notebook.ipynb
git commit -m "type: description"
git push origin master

# Validate in Colab (final check)
# https://colab.research.google.com/github/shandley/evomics-colab-notebooks/blob/master/notebook.ipynb
```

---

## üöÄ Future Notebook Ideas

Planned tutorials (see README.md):
- Genome Assembly (SPAdes)
- RNA-seq Analysis (DESeq2)
- Variant Calling
- Metagenomics (QIIME2)
- Comparative Genomics
- Protein Structure (AlphaFold2)

---

## üìö Key Documents

- **README.md**: User-facing documentation
- **DEVELOPMENT_GUIDE.md**: How to develop new notebooks
- **COMPLETE_WORKFLOW.md**: Technical details of conda setup
- **CONSISTENCY_REVIEW.md**: Explanation quality analysis
- **phylogenetics_tutorial_INSTRUCTOR.ipynb**: Teaching guide

---

## üîó Links

- **Repository**: https://github.com/shandley/evomics-colab-notebooks
- **Evomics**: https://learn.evomics.org
- **Colab direct link**: https://colab.research.google.com/github/shandley/evomics-colab-notebooks/blob/master/phylogenetics_tutorial.ipynb

---

## üí° Tips for AI Assistants

When working on this project:

1. **Always use conda environment** for testing (phylo-dev)
2. **Test locally first** before committing (catches 95% of issues)
3. **Maintain "Run All" compatibility** (no blocking operations)
4. **Match explanation depth** across sections (see CONSISTENCY_REVIEW.md)
5. **Use TODO tracking** for multi-step tasks
6. **Commit frequently** with descriptive messages
7. **Update instructor guide** when changing tutorial content
8. **Verify in Colab** after major changes

---

**Last Updated**: 2025-01-17
**Status**: Production ready
**Main Branch**: master
